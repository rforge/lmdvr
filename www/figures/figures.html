<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" lang="en">
<head>
<title>Lattice - Multivariate Data Visualization with R - Figures and Code</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script src="figures.js" type="text/javascript"></script>
<link rel="stylesheet" media="screen" title="Default Style"
href="style.css"/>
</head>


<body onload="initialize('stdBW')">

<div class="header">
<span style="font-weight: bold; font-size: 120%;">Lattice:</span>
<span> Multivariate Data Visualization with R - </span>
<span style="font-size: 90%;">Figures and Code</span>

</div>

<div class="contact">
  <a onclick="resetCookies()" href="figures.html" title="Delete cookies and reload">Reset</a>
  <a id="PERMALINK" href="" title="Link reflecting current selections" >Permalink</a>
  <!-- <a href="index.html" title="Doesn't exist yet" >Home</a> -->
  <a href="mailto:deepayan.sarkar@r-project.org" >Contact</a>
<!--   <address>Deepayan.Sarkar@R-project.org</address> -->
</div>

<div class="settings">
  <p class="topic" id="stdBW"      onclick="setTheme('stdBW')">  Black and White Theme  </p>
  <p class="topic" id="stdColor"   onclick="setTheme('stdColor')">  Default Color Theme  </p>
  <p class="topic" id="stdClassic" onclick="setTheme('stdClassic')">  Classic Gray Theme </p>
</div>



  
<div class="navigation">

  <!--
  The following snippet can be generated by:

  for i in {01..14}; do
    printf "    <li class=\"topic\" id=\"CHAPTER.%02g\" onClick = 'chapterClicked(\"%02g\")'>Chapter %g</li>\n" $i $i $i 
  done

    -->

  
  <ul class="ChapterList" id="ChapterRoot">
    <li><p title="Introduction" class="topic" id="CHAPTER.01" onClick = 'chapterClicked("01", 1)'>Chapter 1</p>
    <ul class="FigureListHidden" id="FIGURELIST.01">
      <li class="topic" id="FIGURE.01_01" onClick='figureClicked("01_01")'>Figure 1.1</li>
      <li class="topic" id="FIGURE.01_02" onClick='figureClicked("01_02")'>Figure 1.2</li>
      <li class="topic" id="FIGURE.01_03" onClick='figureClicked("01_03")'>Figure 1.3</li>
      <li class="topic" id="FIGURE.01_04" onClick='figureClicked("01_04")'>Figure 1.4</li>
    </ul></li>
    <li title="A Technical Overview of lattice"><p class="topic" id="CHAPTER.02" onClick = 'chapterClicked("02", 1)'>Chapter 2</p>
    <ul class="FigureListHidden" id="FIGURELIST.02">
      <li class="topic" id="FIGURE.02_01" onClick='figureClicked("02_01")'>Figure 2.1</li>
      <li class="topic" id="FIGURE.02_02" onClick='figureClicked("02_02")'>Figure 2.2</li>
      <li class="topic" id="FIGURE.02_03" onClick='figureClicked("02_03")'>Figure 2.3</li>
      <li class="topic" id="FIGURE.02_04" onClick='figureClicked("02_04")'>Figure 2.4</li>
      <li class="topic" id="FIGURE.02_05" onClick='figureClicked("02_05")'>Figure 2.5</li>
      <li class="topic" id="FIGURE.02_06" onClick='figureClicked("02_06")'>Figure 2.6</li>
      <li class="topic" id="FIGURE.02_07" onClick='figureClicked("02_07")'>Figure 2.7</li>
      <li class="topic" id="FIGURE.02_08" onClick='figureClicked("02_08")'>Figure 2.8</li>
      <li class="topic" id="FIGURE.02_09" onClick='figureClicked("02_09")'>Figure 2.9</li>
      <li class="topic" id="FIGURE.02_10" onClick='figureClicked("02_10")'>Figure 2.10</li>
      <li class="topic" id="FIGURE.02_11" onClick='figureClicked("02_11")'>Figure 2.11</li>
    </ul></li>
    <li><p title="Visualizing Univariate Distributions" class="topic" id="CHAPTER.03" onClick = 'chapterClicked("03", 1)'>Chapter 3</p>
    <ul class="FigureListHidden" id="FIGURELIST.03">
      <li class="topic" id="FIGURE.03_01" onClick='figureClicked("03_01")'>Figure 3.1</li>
      <li class="topic" id="FIGURE.03_02" onClick='figureClicked("03_02")'>Figure 3.2</li>
      <li class="topic" id="FIGURE.03_03" onClick='figureClicked("03_03")'>Figure 3.3</li>
      <li class="topic" id="FIGURE.03_04" onClick='figureClicked("03_04")'>Figure 3.4</li>
      <li class="topic" id="FIGURE.03_05" onClick='figureClicked("03_05")'>Figure 3.5</li>
      <li class="topic" id="FIGURE.03_06" onClick='figureClicked("03_06")'>Figure 3.6</li>
      <li class="topic" id="FIGURE.03_07" onClick='figureClicked("03_07")'>Figure 3.7</li>
      <li class="topic" id="FIGURE.03_08" onClick='figureClicked("03_08")'>Figure 3.8</li>
      <li class="topic" id="FIGURE.03_09" onClick='figureClicked("03_09")'>Figure 3.9</li>
      <li class="topic" id="FIGURE.03_10" onClick='figureClicked("03_10")'>Figure 3.10</li>
      <li class="topic" id="FIGURE.03_11" onClick='figureClicked("03_11")'>Figure 3.11</li>
      <li class="topic" id="FIGURE.03_12" onClick='figureClicked("03_12")'>Figure 3.12</li>
      <li class="topic" id="FIGURE.03_13" onClick='figureClicked("03_13")'>Figure 3.13</li>
      <li class="topic" id="FIGURE.03_14" onClick='figureClicked("03_14")'>Figure 3.14</li>
      <li class="topic" id="FIGURE.03_15" onClick='figureClicked("03_15")'>Figure 3.15</li>
      <li class="topic" id="FIGURE.03_16" onClick='figureClicked("03_16")'>Figure 3.16</li>
      <li class="topic" id="FIGURE.03_17" onClick='figureClicked("03_17")'>Figure 3.17</li>
    </ul></li>
    <li><p title="Displaying Multiway Tables" class="topic" id="CHAPTER.04" onClick = 'chapterClicked("04", 1)'>Chapter 4</p>
    <ul class="FigureListHidden" id="FIGURELIST.04">
      <li class="topic" id="FIGURE.04_01" onClick='figureClicked("04_01")'>Figure 4.1</li>
      <li class="topic" id="FIGURE.04_02" onClick='figureClicked("04_02")'>Figure 4.2</li>
      <li class="topic" id="FIGURE.04_03" onClick='figureClicked("04_03")'>Figure 4.3</li>
      <li class="topic" id="FIGURE.04_04" onClick='figureClicked("04_04")'>Figure 4.4</li>
      <li class="topic" id="FIGURE.04_05" onClick='figureClicked("04_05")'>Figure 4.5</li>
      <li class="topic" id="FIGURE.04_06" onClick='figureClicked("04_06")'>Figure 4.6</li>
      <li class="topic" id="FIGURE.04_07" onClick='figureClicked("04_07")'>Figure 4.7</li>
      <li class="topic" id="FIGURE.04_08" onClick='figureClicked("04_08")'>Figure 4.8</li>
      <li class="topic" id="FIGURE.04_09" onClick='figureClicked("04_09")'>Figure 4.9</li>
    </ul></li>
    <li><p title="Scatter Plots and Extensions" class="topic" id="CHAPTER.05" onClick = 'chapterClicked("05", 1)'>Chapter 5</p>
    <ul class="FigureListHidden" id="FIGURELIST.05">
      <li class="topic" id="FIGURE.05_01" onClick='figureClicked("05_01")'>Figure 5.1</li>
      <li class="topic" id="FIGURE.05_02" onClick='figureClicked("05_02")'>Figure 5.2</li>
      <li class="topic" id="FIGURE.05_03" onClick='figureClicked("05_03")'>Figure 5.3</li>
      <li class="topic" id="FIGURE.05_04" onClick='figureClicked("05_04")'>Figure 5.4</li>
      <li class="topic" id="FIGURE.05_05" onClick='figureClicked("05_05")'>Figure 5.5</li>
      <li class="topic" id="FIGURE.05_06" onClick='figureClicked("05_06")'>Figure 5.6</li>
      <li class="topic" id="FIGURE.05_07" onClick='figureClicked("05_07")'>Figure 5.7</li>
      <li class="topic" id="FIGURE.05_08" onClick='figureClicked("05_08")'>Figure 5.8</li>
      <li class="topic" id="FIGURE.05_09" onClick='figureClicked("05_09")'>Figure 5.9</li>
      <li class="topic" id="FIGURE.05_10" onClick='figureClicked("05_10")'>Figure 5.10</li>
      <li class="topic" id="FIGURE.05_11" onClick='figureClicked("05_11")'>Figure 5.11</li>
      <li class="topic" id="FIGURE.05_12" onClick='figureClicked("05_12")'>Figure 5.12</li>
      <li class="topic" id="FIGURE.05_13" onClick='figureClicked("05_13")'>Figure 5.13</li>
      <li class="topic" id="FIGURE.05_14" onClick='figureClicked("05_14")'>Figure 5.14</li>
      <li class="topic" id="FIGURE.05_15" onClick='figureClicked("05_15")'>Figure 5.15</li>
      <li class="topic" id="FIGURE.05_16" onClick='figureClicked("05_16")'>Figure 5.16</li>
      <li class="topic" id="FIGURE.05_17" onClick='figureClicked("05_17")'>Figure 5.17</li>
      <li class="topic" id="FIGURE.05_18" onClick='figureClicked("05_18")'>Figure 5.18</li>
      <li class="topic" id="FIGURE.05_19" onClick='figureClicked("05_19")'>Figure 5.19</li>
    </ul></li>
    <li><p title="Trivariate Displays" class="topic" id="CHAPTER.06" onClick = 'chapterClicked("06", 1)'>Chapter 6</p>
    <ul class="FigureListHidden" id="FIGURELIST.06">
      <li class="topic" id="FIGURE.06_01" onClick='figureClicked("06_01")'>Figure 6.1</li>
      <li class="topic" id="FIGURE.06_02" onClick='figureClicked("06_02")'>Figure 6.2</li>
      <li class="topic" id="FIGURE.06_03" onClick='figureClicked("06_03")'>Figure 6.3</li>
      <li class="topic" id="FIGURE.06_04" onClick='figureClicked("06_04")'>Figure 6.4</li>
      <li class="topic" id="FIGURE.06_05" onClick='figureClicked("06_05")'>Figure 6.5</li>
      <li class="topic" id="FIGURE.06_06" onClick='figureClicked("06_06")'>Figure 6.6</li>
      <li class="topic" id="FIGURE.06_07" onClick='figureClicked("06_07")'>Figure 6.7</li>
      <li class="topic" id="FIGURE.06_08" onClick='figureClicked("06_08")'>Figure 6.8</li>
      <li class="topic" id="FIGURE.06_09" onClick='figureClicked("06_09")'>Figure 6.9</li>
      <li class="topic" id="FIGURE.06_10" onClick='figureClicked("06_10")'>Figure 6.10</li>
      <li class="topic" id="FIGURE.06_11" onClick='figureClicked("06_11")'>Figure 6.11</li>
      <li class="topic" id="FIGURE.06_12" onClick='figureClicked("06_12")'>Figure 6.12</li>
      <li class="topic" id="FIGURE.06_13" onClick='figureClicked("06_13")'>Figure 6.13</li>
      <li class="topic" id="FIGURE.06_14" onClick='figureClicked("06_14")'>Figure 6.14</li>
      <li class="topic" id="FIGURE.06_15" onClick='figureClicked("06_15")'>Figure 6.15</li>
      <li class="topic" id="FIGURE.06_16" onClick='figureClicked("06_16")'>Figure 6.16</li>
      <li class="topic" id="FIGURE.06_17" onClick='figureClicked("06_17")'>Figure 6.17</li>
      <li class="topic" id="FIGURE.06_18" onClick='figureClicked("06_18")'>Figure 6.18</li>
      <li class="topic" id="FIGURE.06_19" onClick='figureClicked("06_19")'>Figure 6.19</li>
    </ul></li>
    <li><p title="Graphical Parameters and Other Settings" class="topic" id="CHAPTER.07" onClick = 'chapterClicked("07", 1)'>Chapter 7</p>
    <ul class="FigureListHidden" id="FIGURELIST.07">
      <li class="topic" id="FIGURE.07_01" onClick='figureClicked("07_01")'>Figure 7.1</li>
      <li class="topic" id="FIGURE.07_02" onClick='figureClicked("07_02")'>Figure 7.2</li>
      <li class="topic" id="FIGURE.07_03" onClick='figureClicked("07_03")'>Figure 7.3</li>
      <li class="topic" id="FIGURE.07_04" onClick='figureClicked("07_04")'>Figure 7.4</li>
    </ul></li>
    <li><p title="Plot Coordinates and Axis Annotation" class="topic" id="CHAPTER.08" onClick = 'chapterClicked("08", 1)'>Chapter 8</p>
    <ul class="FigureListHidden" id="FIGURELIST.08">
      <li class="topic" id="FIGURE.08_01" onClick='figureClicked("08_01")'>Figure 8.1</li>
      <li class="topic" id="FIGURE.08_02" onClick='figureClicked("08_02")'>Figure 8.2</li>
      <li class="topic" id="FIGURE.08_03" onClick='figureClicked("08_03")'>Figure 8.3</li>
      <li class="topic" id="FIGURE.08_04" onClick='figureClicked("08_04")'>Figure 8.4</li>
      <li class="topic" id="FIGURE.08_05" onClick='figureClicked("08_05")'>Figure 8.5</li>
      <li class="topic" id="FIGURE.08_06" onClick='figureClicked("08_06")'>Figure 8.6</li>
    </ul></li>
    <li><p title="Labels and Legends" class="topic" id="CHAPTER.09" onClick = 'chapterClicked("09", 1)'>Chapter 9</p>
    <ul class="FigureListHidden" id="FIGURELIST.09">
      <li class="topic" id="FIGURE.09_01" onClick='figureClicked("09_01")'>Figure 9.1</li>
      <li class="topic" id="FIGURE.09_02" onClick='figureClicked("09_02")'>Figure 9.2</li>
      <li class="topic" id="FIGURE.09_03" onClick='figureClicked("09_03")'>Figure 9.3</li>
    </ul></li>
    <li><p title="Data Manipulation and Related Topics" class="topic" id="CHAPTER.10" onClick = 'chapterClicked("10", 1)'>Chapter 10</p>
    <ul class="FigureListHidden" id="FIGURELIST.10">
      <li class="topic" id="FIGURE.10_01" onClick='figureClicked("10_01")'>Figure 10.1</li>
      <li class="topic" id="FIGURE.10_02" onClick='figureClicked("10_02")'>Figure 10.2</li>
      <li class="topic" id="FIGURE.10_03" onClick='figureClicked("10_03")'>Figure 10.3</li>
      <li class="topic" id="FIGURE.10_04" onClick='figureClicked("10_04")'>Figure 10.4</li>
      <li class="topic" id="FIGURE.10_05" onClick='figureClicked("10_05")'>Figure 10.5</li>
      <li class="topic" id="FIGURE.10_06" onClick='figureClicked("10_06")'>Figure 10.6</li>
      <li class="topic" id="FIGURE.10_07" onClick='figureClicked("10_07")'>Figure 10.7</li>
      <li class="topic" id="FIGURE.10_08" onClick='figureClicked("10_08")'>Figure 10.8</li>
      <li class="topic" id="FIGURE.10_09" onClick='figureClicked("10_09")'>Figure 10.9</li>
      <li class="topic" id="FIGURE.10_10" onClick='figureClicked("10_10")'>Figure 10.10</li>
      <li class="topic" id="FIGURE.10_11" onClick='figureClicked("10_11")'>Figure 10.11</li>
      <li class="topic" id="FIGURE.10_12" onClick='figureClicked("10_12")'>Figure 10.12</li>
      <li class="topic" id="FIGURE.10_13" onClick='figureClicked("10_13")'>Figure 10.13</li>
      <li class="topic" id="FIGURE.10_14" onClick='figureClicked("10_14")'>Figure 10.14</li>
      <li class="topic" id="FIGURE.10_15" onClick='figureClicked("10_15")'>Figure 10.15</li>
      <li class="topic" id="FIGURE.10_16" onClick='figureClicked("10_16")'>Figure 10.16</li>
      <li class="topic" id="FIGURE.10_17" onClick='figureClicked("10_17")'>Figure 10.17</li>
      <li class="topic" id="FIGURE.10_18" onClick='figureClicked("10_18")'>Figure 10.18</li>
      <li class="topic" id="FIGURE.10_19" onClick='figureClicked("10_19")'>Figure 10.19</li>
      <li class="topic" id="FIGURE.10_20" onClick='figureClicked("10_20")'>Figure 10.20</li>
      <li class="topic" id="FIGURE.10_21" onClick='figureClicked("10_21")'>Figure 10.21</li>
      <li class="topic" id="FIGURE.10_22" onClick='figureClicked("10_22")'>Figure 10.22</li>
      <li class="topic" id="FIGURE.10_23" onClick='figureClicked("10_23")'>Figure 10.23</li>
      <li class="topic" id="FIGURE.10_24" onClick='figureClicked("10_24")'>Figure 10.24</li>
      <li class="topic" id="FIGURE.10_25" onClick='figureClicked("10_25")'>Figure 10.25</li>
    </ul></li>
    <li><p title="Manipulating the trellis Object" class="topic" id="CHAPTER.11" onClick = 'chapterClicked("11", 1)'>Chapter 11</p>
    <ul class="FigureListHidden" id="FIGURELIST.11">
      <li class="topic" id="FIGURE.11_01" onClick='figureClicked("11_01")'>Figure 11.1</li>
      <li class="topic" id="FIGURE.11_02" onClick='figureClicked("11_02")'>Figure 11.2</li>
      <li class="topic" id="FIGURE.11_03" onClick='figureClicked("11_03")'>Figure 11.3</li>
      <li class="topic" id="FIGURE.11_04" onClick='figureClicked("11_04")'>Figure 11.4</li>
      <li class="topic" id="FIGURE.11_05" onClick='figureClicked("11_05")'>Figure 11.5</li>
      <li class="topic" id="FIGURE.11_06" onClick='figureClicked("11_06")'>Figure 11.6</li>
    </ul></li>
    <li><p title="Interacting with Trellis Displays" class="topic" id="CHAPTER.12" onClick = 'chapterClicked("12", 1)'>Chapter 12</p>
    <ul class="FigureListHidden" id="FIGURELIST.12">
    </ul></li>
    <li><p title="Advanced Panel Functions" class="topic" id="CHAPTER.13" onClick = 'chapterClicked("13", 1)'>Chapter 13</p>
    <ul class="FigureListHidden" id="FIGURELIST.13">
      <li class="topic" id="FIGURE.13_01" onClick='figureClicked("13_01")'>Figure 13.1</li>
      <li class="topic" id="FIGURE.13_02" onClick='figureClicked("13_02")'>Figure 13.2</li>
      <li class="topic" id="FIGURE.13_03" onClick='figureClicked("13_03")'>Figure 13.3</li>
      <li class="topic" id="FIGURE.13_04" onClick='figureClicked("13_04")'>Figure 13.4</li>
      <li class="topic" id="FIGURE.13_05" onClick='figureClicked("13_05")'>Figure 13.5</li>
      <li class="topic" id="FIGURE.13_06" onClick='figureClicked("13_06")'>Figure 13.6</li>
      <li class="topic" id="FIGURE.13_07" onClick='figureClicked("13_07")'>Figure 13.7</li>
      <li class="topic" id="FIGURE.13_08" onClick='figureClicked("13_08")'>Figure 13.8</li>
      <li class="topic" id="FIGURE.13_09" onClick='figureClicked("13_09")'>Figure 13.9</li>
      <li class="topic" id="FIGURE.13_10" onClick='figureClicked("13_10")'>Figure 13.10</li>
    </ul></li>
    <li><p title="New Trellis Displays" class="topic" id="CHAPTER.14" onClick = 'chapterClicked("14", 1)'>Chapter 14</p>
    <ul class="FigureListHidden" id="FIGURELIST.14">
      <li class="topic" id="FIGURE.14_01" onClick='figureClicked("14_01")'>Figure 14.1</li>
      <li class="topic" id="FIGURE.14_02" onClick='figureClicked("14_02")'>Figure 14.2</li>
      <li class="topic" id="FIGURE.14_03" onClick='figureClicked("14_03")'>Figure 14.3</li>
      <li class="topic" id="FIGURE.14_04" onClick='figureClicked("14_04")'>Figure 14.4</li>
      <li class="topic" id="FIGURE.14_05" onClick='figureClicked("14_05")'>Figure 14.5</li>
    </ul></li>
  </ul>
  <hr>
  <ul class="ChapterList" id="EXTRACTS">
    <li><p title="Preface and sample chapter" class="topic" id="CHAPTER.EXTRACTS" onClick = 'showExtracts()'>Extracts</p>
  </ul>
  <ul class="ChapterList" id="ERRATA">
    <li><p title="Errata" class="topic" id="CHAPTER.ERRATA" onClick = 'showErrata()'>Errata</p>
  </ul>
  <ul class="ChapterList" id="REVIEWS">
    <li><p title="Reviews" class="topic" id="CHAPTER.REVIEWS" onClick = 'showReviews()'>Reviews</p>
  </ul>


<!--   <ul class="ChapterList" id="EXTRACTS"> -->
<!--     <li><p title="Preface and sample chapter" class="topic" id="CHAPTER.EXTRACTS" >Extracts</p> -->
<!--     <ul class="FigureList" id="FIGURELIST.EXTRACTS"> -->
<!--       <li class="topic" id="EXTRACT.PREFACE" onClick='figureClicked("09_01")'><a href="preface.pdf" >Preface/TOC</a></li> -->
<!--       <li class="topic" id="EXTRACT.CHAPTER2" onClick='figureClicked("09_02")'><a href="chapter2.pdf" >Chapter 2</a></li> -->
<!--     </ul></li> -->
<!--   </ul> -->


    
  
  <!-- 
  placeholders:

  for i in {1..14}; do
  printf "  <ul class=\"FigureListHidden\" id=\"FIGURELIST.%02g\">\n  </ul>\n" $i
  done


  for i in `ls images | cut -d'_' -f2,3 | uniq`; do
  printf "<li class=\"topic\" id=\"FIGURE.%s\" onClick='figureClicked(\"%s\")'>Figure %s</li>\n" $i $i $i
  done | less
  
  -->




</div>


<div class="summaryContainer" id="SUMMARY.CONTAINER">
  
  <div class="summary" id="SUMMARY.00">
    <p>
    <a href="http://www.springer.com/978-0-387-75968-5" >
    <img src="cover.png" alt="" height="" width=""
    align="left" style="float:left; padding: 1em; border:none;">
    </a>
    <a
    href="http://www.springer.com/978-0-387-75968-5" >Lattice:
    Multivariate Data Visualization with R</a>
    [<a href="http://www.r-project.org/doc/bib/R-books_bib.html#R:Sarkar:2007" >BibTeX</a>]
    <br>Deepayan Sarkar
    <!-- br>Published by Springer (March 12, 2008) as part of the <a href="http://www.springer.com/series/6991" >Use R</a> series</p -->
    <br>(part of Springer's <a href="http://www.springer.com/series/6991" >Use R</a> series)</p>


    <!-- <h2>Lattice: Multivariate Data Visualization with R</h2> -->
    <p> This webpage provides access to figures and code from the book.
    It can be viewed with any standards compliant browser with
    Javascript and CSS support enabled (IE7 barely manages, IE6 fails
    miserably).  Cookies are optional; if allowed, they will make
    selections persistent across sessions.  </p>

    <p>Click on the chapter links for a brief summary and a list of
    figures, as well as a listing of code from that chapter.  Click on
    the figure links to see the corresponding plots. </p>

    <!--
    <p> Code listings are currently only available for entire
    chapters.  Providing minimal code for each figure is a bit more
    work, and will be made available once the contents of the book are
    finalized.
    </p>
    -->

    <p> Each figure is available in several versions, representing
    different &quot;themes&quot;.  Most of the code was written for
    the black and white theme used in the book.  It has been run
    unchanged with the color themes to produce the color versions.
    For the most part, the results are acceptable, and generally
    better in color.  In some cases (e.g., Figure 2.7), attempts to
    write code tuned to the black and white theme has made the color
    versions less useful than they could have been.  </p>

    <h2>Requirements</h2>

    <p> Several R packages are needed to run all the code given here.
Some (<code>grid</code>, <code>lattice</code>, and <code>MASS</code>)
should already be installed along with R.  The remaining ones, along
with their dependencies, can be downloaded from <a
href="http://cran.r-project.org" >CRAN</a> and <a
href="http://www.bioconductor.org" >Bioconductor</a> using the
following code snippet:
<pre>
install.packages(c("latticeExtra", "copula", "ellipse", "gridBase",
                   "locfit", "logspline", "mapproj", "maps", "MEMSS",
                   "mlmRev", "RColorBrewer"))
source("http://bioconductor.org/biocLite.R")
biocLite(c("flowCore", "flowViz", "hexbin"))
</pre>
  </p>


  </div>


  <div class="summaryHidden" id="SUMMARY.ERRATA">
    <h2>Errata</h2>
    <dl>
      <dt>Page 59
      <dd>&quot;Table 4.2&quot; should be &quot;Table 4.1&quot;
    </dl>
    <p>[Fixed in the second printing]</p>
    <dl>
      <dt>Page 45
      <dd>Figure 3.9 has <code>xlab="Standard Normal
	Quantiles"</code>. This should be <code>xlab="Uniform(0, 1)
	Quantiles"</code>.
      <dt>Page 109
      <dd>&quot;Figure 6.4&quot; should be &quot;Figure 6.15&quot;
    </dl>
  </div>
  

  <div class="summaryHidden" id="SUMMARY.EXTRACTS">
    <h2>Extracts from the book</h2>
    <ul>
      <li><a href="http://dsarkar.fhcrc.org/lattice/book/preface.pdf" >Preface and Table of contents</a></li>
      <li><a href="http://dsarkar.fhcrc.org/lattice/book/chapter2.pdf" >Chapter 2</a></li>
    </ul>
  </div>
  
  <div class="summaryHidden" id="SUMMARY.REVIEWS">
    <h2>Reviews</h2>
    <ul>
      <li><a href="http://www.jstatsoft.org/v25/b02" >Journal of Statistical Software</a></li>
      <li><a href="http://www.amazon.com/review/product/0387759689/" >Amazon</a></li>
    </ul>
  </div>
  



  
<!-- The next part has hard-coded summaries for all chapters.
Placehlders can be generated with:

  for i in {1..14}; do
    printf "  <div class=\"summaryHidden\" id=\"SUMMARY.%02g\">\n    <h2>Chapter %g</h2>\n    <p>Topics covered:</p>\n    <ul>\n      <li>foo</li>\n    </ul>\n  </div>\n" $i $i
  done
    

-->


  <div class="summaryHidden" id="SUMMARY.01">
    <h2>Introduction</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Basic usage; high level functions</li>
      <li>Conditioning</li>
      <li>Superposition (a.k.a. grouping)</li>
      <li>&quot;trellis&quot; objects</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>

  <div class="summaryHidden" id="SUMMARY.02">
  <h2>A Technical Overview of lattice</h2>
    <p> Gives a &quot;big picture&quot; view of the system. </p>
    <p> Topics covered:</p>
    <ul>
      <li>The formula interface</li>
      <li>object dimensions and physical layout</li>
      <li>Annotation</li>
      <li>Scales and Axes</li>
      <li>Panel functions</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.03">
    <h2>Visualizing Univariate Distributions</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Kernel Density Plot, Histogram</li>
      <li>Theoretical Q-Q plot, Empirical CDF plot</li>
      <li>Two-sample Q-Q plot</li>
      <li>Comparative Box and Whisker plots, Violin plots</li>
      <li>Comparative Strip charts</li>
      <li>Discrete distributions</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.04">
    <h2>Displaying Multiway Tables</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Cleveland dot plot</li>
      <li>Bar chart</li>
      <li>Reordering factor levels</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.05">
    <h2>Scatter Plots and Extensions</h2>
    <p>Topics covered:</p>
    <ul>
      <li>The standard scatter plot</li>
      <li>Using <code>subscripts</code></li>
      <li>Using the <code>type</code> argument</li>
      <li>Variants for large data</li>
      <li>Scatter plot matrix</li>
      <li>Parallel coordinate plot</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.06">
    <h2>Trivariate Displays</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Three dimensional scatter plots</li>
      <li>Surfaces and two-way tables</li>
      <li>Level plots and contour plots</li>
      <li>Wireframe rendering</li>
      <li>Parameterized surfaces</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.07">
    <h2>Graphical Parameters and Other Settings</h2>
    <p>Topics covered:</p>
    <ul>
      <li>The graphical parameter system</li>
      <li>Themes, devices</li>
      <li>Initializing graphics devices</li>
      <li>Querying and modifying parameters</li>
      <li>Available parameters</li>
      <li>Non-graphical options</li>
      <li>Making customizations persistent</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.08">
    <h2>Plot Coordinates and Axis Annotation</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Packets</li>
      <li>The prepanel function, axis limits, and aspect ratio</li>
      <li>Axis annotation</li>
      <li>The <code>scales</code> argument</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.09">
    <h2>Labels and Legends</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Labels (<code>main</code>, <code>sub</code>, <code>xlab</code>, <code>ylab</code>)</li>
      <li>Legends, color keys</li>
      <li>Legends in grouped displays; <code>auto.key</code></li>
      <li>Dropping unused levels of grouping variable</li>
      <li>Page annotation</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.10">
    <h2>Data Manipulation and Related Topics</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Non-standard evaluation in the context of <code>lattice</code></li>
      <li>The extended formula interface</li>
      <li>Combining data sources, subsetting</li>
      <li>Shingles</li>
      <li>Ordering levels of categorical variables</li>
      <li>Controlling the appearance of strips</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.11">
    <h2>Manipulating the &quot;trellis&quot; object</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Methods for &quot;trellis&quot; objects</li>
      <li>Tukey mean-difference plot</li>
      <li>Other specialized manipulations</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.12">
    <h2>Interacting with Trellis Displays</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Comparison with the traditional graphics model</li>
      <li>Grid viewports as used in <code>lattice</code></li>
      <li>API for interactive additions</li>
    </ul>
    <!-- p>Click on figure links on the left to see figures.</p -->
  </div>
  <div class="summaryHidden" id="SUMMARY.13">
    <h2>Advanced Panel Functions</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Built-in panel and accessors functions</li>
      <li>Examples</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>
  <div class="summaryHidden" id="SUMMARY.14">
    <h2>New Trellis Displays</h2>
    <p>Topics covered:</p>
    <ul>
      <li>Examples of S3 and S4 methods</li>
      <li>Examples of new high level functions</li>
    </ul>
    <p>Click on figure links on the left to see figures.</p>
  </div>



  
</div>




<!-- Images get downloaded on demand -->


<div class="imageHidden" id="IMAGE.CONTAINER">
  <img id="IMAGE"
  src="images/loading.png">
  <!-- change this to something static -->
</div>

<!-- 

  for i in {1..14}; do
    printf "<div class=\"codeListingHidden\" id=\"CODE.%02g\">\n</div>\n" $i
  done

    -->

<div class="codeContainer" id="CODE.CONTAINER">

<span class="switchLayout" id="SWITCH.LAYOUT" style="display: none;"
  onclick="switchLayout()">Switch code layout</span>
  
<!-- <iframe src="setup.R" frameborder="0" width="100%" height="500"> -->
<!-- alternate -->
<!-- </iframe> -->

<div class="codeListing" id="CODE.00"></div>
  
<div class="codeListingHidden" id="CODE.01">## Chapter 1

data(Chem97, package = "mlmRev")
xtabs( ~ score, data = Chem97)
library("lattice")

<span class="comment">## Figure 1.1</span>
histogram(~ gcsescore | factor(score), data = Chem97)

<span class="comment">## Figure 1.2</span>
densityplot(~ gcsescore | factor(score), data = Chem97, 
            plot.points = FALSE, ref = TRUE)

<span class="comment">## Figure 1.3</span>
densityplot(~ gcsescore, data = Chem97, groups = score,
            plot.points = FALSE, ref = TRUE,
            auto.key = list(columns = 3))

<span class="comment">## Figure 1.4</span>
tp1 <- histogram(~ gcsescore | factor(score), data = Chem97)
tp2 <- 
    densityplot(~ gcsescore, data = Chem97, groups = score,
                plot.points = FALSE,
                auto.key = list(space = "right", title = "score"))
class(tp2)
summary(tp1)
plot(tp1, split = c(1, 1, 1, 2))
plot(tp2, split = c(1, 2, 1, 2), newpage = FALSE)
</div>


<div class="codeListingHidden" id="CODE.02"><span class="comment">## Chapter 2</span>

data(Oats, package = "MEMSS")

<span class="comment">## Figure 2.1</span>
tp1.oats <- 
    xyplot(yield ~ nitro | Variety + Block, data = Oats, type = 'o')
print(tp1.oats)

dim(tp1.oats)
dimnames(tp1.oats)
xtabs(~Variety + Block, data = Oats)
summary(tp1.oats)
summary(tp1.oats[, 1])

<span class="comment">## Figure 2.2</span>
print(tp1.oats[, 1])

<span class="comment">## Figure 2.3</span>
update(tp1.oats, 
       aspect="xy")

<span class="comment">## Figure 2.4</span>
update(tp1.oats, aspect = "xy",
       layout = c(0, 18))

<span class="comment">## Figure 2.5</span>
update(tp1.oats, aspect = "xy", layout = c(0, 18), 
       between = list(x = c(0, 0, 0.5), y = 0.5))

<span class="comment">## Figure 2.6</span>
dotplot(variety ~ yield | site, barley, 
        layout = c(1, 6), aspect = c(0.7),
        groups = year, auto.key = list(space = 'right'))

<span class="comment">## Figure 2.7</span>
key.variety <- 
    list(space = "right", text = list(levels(Oats$Variety)),
         points = list(pch = 1:3, col = "black"))
xyplot(yield ~ nitro | Block, Oats, aspect = "xy", type = "o", 
       groups = Variety, key = key.variety, lty = 1, pch = 1:3, 
       col.line = "darkgrey", col.symbol = "black",
       xlab = "Nitrogen concentration (cwt/acre)",
       ylab = "Yield (bushels/acre)", 
       main = "Yield of three varieties of oats",
       sub = "A 3 x 4 split plot experiment with 6 blocks")

<span class="comment">## Figure 2.8</span>
barchart(Class ~ Freq | Sex + Age, data = as.data.frame(Titanic), 
         groups = Survived, stack = TRUE, layout = c(4, 1),
         auto.key = list(title = "Survived", columns = 2))

<span class="comment">## Figure 2.9</span>
barchart(Class ~ Freq | Sex + Age, data = as.data.frame(Titanic), 
         groups = Survived, stack = TRUE, layout = c(4, 1), 
         auto.key = list(title = "Survived", columns = 2),
         scales = list(x = "free"))

<span class="comment">## Figure 2.10</span>
bc.titanic <- 
    barchart(Class ~ Freq | Sex + Age, as.data.frame(Titanic), 
             groups = Survived, stack = TRUE, layout = c(4, 1),
             auto.key = list(title = "Survived", columns = 2),
             scales = list(x = "free"))
update(bc.titanic, 
       panel = function(...) {
           panel.grid(h = 0, v = -1)
           panel.barchart(...)
       })

<span class="comment">## Figure 2.11</span>
update(bc.titanic, 
       panel = function(..., border) {
           panel.barchart(..., border = "transparent")
       })
</div>
<div class="codeListingHidden" id="CODE.03"><span class="comment">## Chapter 3</span>

<span class="comment">## Figure 3.1</span>
densityplot(~ eruptions, data = faithful)

<span class="comment">## Figure 3.2</span>
densityplot(~ eruptions, data = faithful, 
            kernel = "rect", bw = 0.2, plot.points = "rug", n = 200)

library("latticeExtra")
data(gvhd10)

<span class="comment">## Figure 3.3</span>
densityplot(~log(FSC.H) | Days, data = gvhd10, 
            plot.points = FALSE, ref = TRUE, layout = c(2, 4))

<span class="comment">## Figure 3.4</span>
histogram(~log2(FSC.H) | Days, gvhd10, xlab = "log Forward Scatter",
          type = "density", nint = 50, layout = c(2, 4))

data(Chem97, package = "mlmRev")

<span class="comment">## Figure 3.5</span>
qqmath(~ gcsescore | factor(score), data = Chem97, 
       f.value = ppoints(100))

<span class="comment">## Figure 3.6</span>
qqmath(~ gcsescore | gender, Chem97, groups = score, aspect = "xy", 
       f.value = ppoints(100), auto.key = list(space = "right"),
       xlab = "Standard Normal Quantiles", 
       ylab = "Average GCSE Score")

Chem97.mod <- transform(Chem97, gcsescore.trans = gcsescore^2.34)

<span class="comment">## Figure 3.7</span>
qqmath(~ gcsescore.trans | gender, Chem97.mod, groups = score,
       f.value = ppoints(100), aspect = "xy",
       auto.key = list(space = "right", title = "score"), 
       xlab = "Standard Normal Quantiles", 
       ylab = "Transformed GCSE Score")

library("latticeExtra")

<span class="comment">## Figure 3.8</span>
ecdfplot(~ gcsescore | factor(score), data = Chem97, 
         groups = gender, auto.key = list(columns = 2),
         subset = gcsescore > 0, xlab = "Average GCSE Score")

<span class="comment">## Figure 3.9</span>
qqmath(~ gcsescore | factor(score), data = Chem97, groups = gender, 
       auto.key = list(points = FALSE, lines = TRUE, columns = 2),
       subset = gcsescore > 0, type = "l", distribution = qunif, 
       prepanel = prepanel.qqmathline, aspect = "xy",
       xlab = "Standard Normal Quantiles", 
       ylab = "Average GCSE Score")

<span class="comment">## Figure 3.10</span>
qq(gender ~ gcsescore | factor(score), Chem97, 
   f.value = ppoints(100), aspect = 1)

<span class="comment">## Figure 3.11</span>
bwplot(factor(score) ~ gcsescore | gender, data = Chem97, 
       xlab = "Average GCSE Score")

<span class="comment">## Figure 3.12</span>
bwplot(gcsescore^2.34 ~ gender | factor(score), Chem97, 
       varwidth = TRUE, layout = c(6, 1),
       ylab = "Transformed GCSE score")

<span class="comment">## Figure 3.13</span>
bwplot(Days ~ log(FSC.H), data = gvhd10, 
       xlab = "log(Forward Scatter)", ylab = "Days Past Transplant")

<span class="comment">## Figure 3.14</span>
bwplot(Days ~ log(FSC.H), gvhd10, 
       panel = panel.violin, box.ratio = 3,
       xlab = "log(Forward Scatter)", 
       ylab = "Days Past Transplant")

<span class="comment">## Figure 3.15</span>
stripplot(factor(mag) ~ depth, quakes)

<span class="comment">## Figure 3.</span>
stripplot(depth ~ factor(mag), quakes, 
          jitter.data = TRUE, alpha = 0.6,
          xlab = "Magnitude (Richter)", ylab = "Depth (km)")

<span class="comment">## Figure 3.16</span>
stripplot(sqrt(abs(residuals(lm(yield~variety+year+site)))) ~ site, 
          data = barley, groups = year, jitter.data = TRUE,
          auto.key = list(points = TRUE, lines = TRUE, columns = 2),
          type = c("p", "a"), fun = median,
          ylab = expression(abs("Residual Barley Yield")^{1 / 2}))
</div>
<div class="codeListingHidden" id="CODE.04"><span class="comment">## Chapter 4</span>

VADeaths
class(VADeaths)
methods("dotplot")

<span class="comment">## Figure 4.1</span>
dotplot(VADeaths, groups = FALSE)

<span class="comment">## Figure 4.2</span>
dotplot(VADeaths, groups = FALSE, 
        layout = c(1, 4), aspect = 0.7, 
        origin = 0, type = c("p", "h"),
        main = "Death Rates in Virginia - 1940", 
        xlab = "Rate (per 1000)")

<span class="comment">## Figure 4.3</span>
dotplot(VADeaths, type = "o",
        auto.key = list(lines = TRUE, space = "right"),
        main = "Death Rates in Virginia - 1940",
        xlab = "Rate (per 1000)")

<span class="comment">## Figure 4.4</span>
barchart(VADeaths, groups = FALSE,
         layout = c(1, 4), aspect = 0.7, reference = FALSE, 
         main = "Death Rates in Virginia - 1940",
         xlab = "Rate (per 100)")

data(postdoc, package = "latticeExtra")

<span class="comment">## Figure 4.5</span>
barchart(prop.table(postdoc, margin = 1), xlab = "Proportion",
         auto.key = list(adj = 1))

<span class="comment">## Figure 4.6</span>
dotplot(prop.table(postdoc, margin = 1), groups = FALSE, 
        xlab = "Proportion",
        par.strip.text = list(abbreviate = TRUE, minlength = 10))

<span class="comment">## Figure 4.7</span>
dotplot(prop.table(postdoc, margin = 1), groups = FALSE, 
        index.cond = function(x, y) median(x),
        xlab = "Proportion", layout = c(1, 5), aspect = 0.6,
        scales = list(y = list(relation = "free", rot = 0)),
        prepanel = function(x, y) {
            list(ylim = levels(reorder(y, x)))
        },
        panel = function(x, y, ...) {
            panel.dotplot(x, reorder(y, x), ...)
        })

data(Chem97, package = "mlmRev")
gcsescore.tab <- xtabs(~gcsescore + gender, Chem97)
gcsescore.df <- as.data.frame(gcsescore.tab)
gcsescore.df$gcsescore <- 
    as.numeric(as.character(gcsescore.df$gcsescore))

<span class="comment">## Figure 4.8</span>
xyplot(Freq ~ gcsescore | gender, data = gcsescore.df, 
       type = "h", layout = c(1, 2), xlab = "Average GCSE Score")

score.tab <- xtabs(~score + gender, Chem97)
score.df <- as.data.frame(score.tab)

<span class="comment">## Figure 4.9</span>
barchart(Freq ~ score | gender, score.df, origin = 0)

</div>
<div class="codeListingHidden" id="CODE.05"><span class="comment">## Chapter 5</span>

<span class="comment">## Figure 5.1</span>
xyplot(lat ~ long | cut(depth, 2), data = quakes)

<span class="comment">## Figure 5.2</span>
xyplot(lat ~ long | cut(depth, 3), data = quakes, 
       aspect = "iso", pch = ".", cex = 2, type = c("p", "g"),
       xlab = "Longitude", ylab = "Latitude", 
       strip = strip.custom(strip.names = TRUE, var.name = "Depth"))

<span class="comment">## Figure 5.3</span>
xyplot(lat ~ long, data = quakes, aspect = "iso",
       groups = cut(depth, breaks = quantile(depth, ppoints(4, 1))), 
       auto.key = list(columns = 3, title = "Depth"), 
       xlab = "Longitude", ylab = "Latitude")

depth.col <- gray.colors(100)[cut(quakes$depth, 100, label = FALSE)]
depth.ord <- rev(order(quakes$depth))

<span class="comment">## Figure 5.4</span>
xyplot(lat ~ long, data = quakes[depth.ord, ], 
       aspect = "iso", type = c("p", "g"), col = "black",
       pch = 21, fill = depth.col[depth.ord], cex = 2,
       xlab = "Longitude", ylab = "Latitude")

quakes$Magnitude <- equal.count(quakes$mag, 4)
summary(quakes$Magnitude)
quakes$color <- depth.col
quakes.ordered <- quakes[depth.ord, ]

<span class="comment">## Figure 5.5</span>
xyplot(lat ~ long | Magnitude, data = quakes.ordered, col = "black",
       aspect = "iso", fill.color = quakes.ordered$color, cex = 2,
       panel = function(x, y, fill.color, ..., subscripts) {
           fill <- fill.color[subscripts]
           panel.grid(h = -1, v = -1)
           panel.xyplot(x, y, pch = 21, fill = fill, ...)
       },
       xlab = "Longitude", ylab = "Latitude")

depth.breaks <- do.breaks(range(quakes.ordered$depth), 50)
quakes.ordered$color <- 
    level.colors(quakes.ordered$depth, at = depth.breaks, 
                 col.regions = gray.colors)

<span class="comment">## Figure 5.6</span>
xyplot(lat ~ long | Magnitude, data = quakes.ordered, 
       aspect = "iso", groups = color, cex = 2, col = "black",
       panel = function(x, y, groups, ..., subscripts) {
           fill <- groups[subscripts]
           panel.grid(h = -1, v = -1)
           panel.xyplot(x, y, pch = 21, fill = fill, ...)
       },
       legend = 
       list(right = 
            list(fun = draw.colorkey,
                 args = list(key = list(col = gray.colors,
                                        at = depth.breaks), 
                             draw = FALSE))),
       xlab = "Longitude", ylab = "Latitude")

types.plain <- c("p", "l", "o", "r", "g", "s", "S", "h", "a", "smooth")
types.horiz <- c("s", "S", "h", "a", "smooth")
horiz <- rep(c(FALSE, TRUE), c(length(types.plain), length(types.horiz)))
types <- c(types.plain, types.horiz)
set.seed(2007041)
x <- sample(seq(-10, 10, length = 15), 30, TRUE)
y <- x + 0.25 * (x + 1)^2 + rnorm(length(x), sd = 5)

<span class="comment">## Figure 5.7</span>
xyplot(y ~ x | gl(1, length(types)),
       xlab = "type", 
       ylab = list(c("horizontal=TRUE", "horizontal=FALSE"), y = c(1/6, 4/6)),
       as.table = TRUE, layout = c(5, 3),
       between = list(y = c(0, 1)),
       strip = function(...) {
           panel.fill(trellis.par.get("strip.background")$col[1])
           type <- types[panel.number()]
           grid.text(lab = sprintf('"%s"', type), 
                     x = 0.5, y = 0.5)
           grid.rect()
       },
       scales = list(alternating = c(0, 2), tck = c(0, 0.7), draw = FALSE),
       par.settings = 
       list(layout.widths = list(strip.left = c(1, 0, 0, 0, 0))),
       panel = function(...) {
           type <- types[panel.number()]
           horizontal <- horiz[panel.number()]
           panel.xyplot(..., 
                        type = type,
                        horizontal = horizontal)
       })[rep(1, length(types))]

data(Earthquake, package = "MEMSS")

<span class="comment">## Figure 5.8</span>
xyplot(accel ~ distance, data = Earthquake,
       panel = function(...) {
           panel.grid(h = -1, v = -1)
           panel.xyplot(...)
           panel.loess(...)
       }, 
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)")

<span class="comment">## Figure 5.9</span>
xyplot(accel ~ distance, data = Earthquake,
       type = c("g", "p", "smooth"),
       scales = list(log = 2),
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)")

library("locfit")
Earthquake$Magnitude <- 
    equal.count(Earthquake$Richter, 3, overlap = 0.1)
coef <- coef(lm(log2(accel) ~ log2(distance), data = Earthquake))

<span class="comment">## Figure 5.10</span>
xyplot(accel ~ distance | Magnitude, data = Earthquake,
       scales = list(log = 2), col.line = "grey", lwd = 2,
       panel = function(...) {
           panel.abline(reg = coef)
           panel.locfit(...)
       },
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)")

data(SeatacWeather, package = "latticeExtra")

<span class="comment">## Figure 5.11</span>
xyplot(min.temp + max.temp + precip ~ day | month,
       ylab = "Temperature and Rainfall", 
       data = SeatacWeather, type = "l", lty = 1, col = "black")

maxp <- max(SeatacWeather$precip, na.rm = TRUE)

<span class="comment">## Figure 5.12</span>
xyplot(min.temp + max.temp + I(80 * precip / maxp) ~ day | month,
       data = SeatacWeather, lty = 1, col = "black",
       ylab = "Temperature and Rainfall", 
       type = c("l", "l", "h"), distribute.type = TRUE)

<span class="comment">## Figure 5.13</span>
update(trellis.last.object(),
       ylab = "Temperature (Fahrenheit) \n and Rainfall (inches)",
       panel = function(...) {
           panel.xyplot(...)
           if (panel.number() == 2) {
               at <- pretty(c(0, max.precip))
               panel.axis("right", half = FALSE,
                          at = at * 80 / max.precip, labels = at)
           }
       })

library("hexbin")
data(gvhd10, package = "latticeExtra")

<span class="comment">## Figure 5.14</span>
xyplot(asinh(SSC.H) ~ asinh(FL2.H) | Days, gvhd10, aspect = 1, 
       panel = panel.hexbinplot, .aspect.ratio = 1, trans = sqrt)

<span class="comment">## Figure 5.15</span>
splom(USArrests)

<span class="comment">## Figure 5.16</span>
splom(~USArrests[c(3, 1, 2, 4)] | state.region, 
      pscales = 0, type = c("g", "p", "smooth"))

<span class="comment">## Figure 5.17</span>
splom(~data.frame(mpg, disp, hp, drat, wt, qsec),
      data = mtcars, groups = cyl, pscales = 0, 
      varnames = c("Miles\nper\ngallon", "Displacement\n(cu. in.)",
                   "Gross\nhorsepower", "Rear\naxle\nratio", 
                   "Weight", "1/4 mile\ntime"),
      auto.key = list(columns = 3, title = "Number of Cylinders"))

<span class="comment">## Figure 5.18</span>
parallel(~mtcars[c(1, 3, 4, 5, 6, 7)] | factor(cyl), 
         mtcars, groups = carb, 
         key = simpleKey(levels(factor(mtcars$carb)), points = FALSE, 
                         lines = TRUE, space = "top", columns = 3), 
         layout = c(3, 1))

data(gvhd10, package = "latticeExtra")

<span class="comment">## Figure 5.19</span>
parallel(~ asinh(gvhd10[c(3, 2, 4, 1, 5)]), data = gvhd10, 
         subset = Days == "13", alpha = 0.01, lty = 1)

</div>
<div class="codeListingHidden" id="CODE.06"><span class="comment">## Chapter 6</span>
  
quakes$Magnitude <- equal.count(quakes$mag, 4)

<span class="comment">## Figure 6.1</span>
cloud(depth ~ lat * long | Magnitude, data = quakes, 
      zlim = rev(range(quakes$depth)),
      screen = list(z = 105, x = -70), panel.aspect = 0.75,
      xlab = "Longitude", ylab = "Latitude", zlab = "Depth")

<span class="comment">## Figure 6.2</span>
cloud(depth ~ lat * long | Magnitude, data = quakes, 
      zlim = rev(range(quakes$depth)), panel.aspect = 0.75,
      screen = list(z = 80, x = -70), zoom = 0.7,
      scales = list(z = list(arrows = FALSE, distance = 2)), 
      xlab = "Longitude", ylab = "Latitude", 
      zlab = list("Depth\n(km)", rot = 90))

p <-
    cloud(depth ~ long + lat, quakes, zlim = c(690, 30),
          pch = ".", cex = 1.5, zoom = 1,
          xlab = NULL, ylab = NULL, zlab = NULL,
          par.settings = list(axis.line = list(col = "transparent")),
          scales = list(draw = FALSE))
npanel <- 4
rotz <- seq(-30, 30, length = npanel)
roty <- c(3, 0)

<span class="comment">## Figure 6.3</span>
update(p[rep(1, 2 * npanel)], 
       layout = c(2, npanel),
       panel = function(..., screen) {
           crow <- current.row()
           ccol <- current.column()
           panel.cloud(..., screen = list(z = rotz[crow], 
                                          x = -60,
                                          y = roty[ccol]))
       })

state.info <-
    data.frame(name = state.name,
               long = state.center$x,
               lat = state.center$y,
               area = state.x77[, "Area"],
               population = 1000 * state.x77[, "Population"])
state.info$density <- with(state.info, population / area)

<span class="comment">## Figure 6.4</span>
cloud(density ~ long + lat, state.info,
      subset = !(name %in% c("Alaska", "Hawaii")),
      type = "h", lwd = 2, zlim = c(0, max(state.info$density)),
      scales = list(arrows = FALSE))

library("maps")
state.map <- map("state", plot=FALSE, fill = FALSE)
panel.3dmap <- function(..., rot.mat, distance, xlim, ylim, zlim,
                        xlim.scaled, ylim.scaled, zlim.scaled)
{
    scaled.val <- function(x, original, scaled) {
        scaled[1] + (x - original[1]) * diff(scaled) / diff(original)
    }
    m <- ltransform3dto3d(rbind(scaled.val(state.map$x, xlim, xlim.scaled),
                                scaled.val(state.map$y, ylim, ylim.scaled),
                                zlim.scaled[1]), 
                          rot.mat, distance)
    panel.lines(m[1,], m[2,], col = "grey76")
}

<span class="comment">## Figure 6.5</span>
cloud(density ~ long + lat, state.info,
      subset = !(name %in% c("Alaska", "Hawaii")),
      panel.3d.cloud = function(...) {
          panel.3dmap(...)
          panel.3dscatter(...)
      }, 
      type = "h", scales = list(draw = FALSE), zoom = 1.1,
      xlim = state.map$range[1:2], ylim = state.map$range[3:4],
      xlab = NULL, ylab = NULL, zlab = NULL,
      aspect = c(diff(state.map$range[3:4]) / diff(state.map$range[1:2]), 0.3),
      panel.aspect = 0.75, lwd = 2, screen = list(z = 30, x = -60),
      par.settings = list(axis.line = list(col = "transparent"),
                          box.3d = list(col = "transparent", alpha = 0)))

data(Cars93, package = "MASS")
cor.Cars93 <- 
    cor(Cars93[, !sapply(Cars93, is.factor)], use = "pair")
data(Chem97, package = "mlmRev")
Chem97$gcd <-
    with(Chem97, 
         cut(gcsescore,
             breaks = quantile(gcsescore, ppoints(11, a = 1))))
ChemTab <- xtabs(~ score + gcd + gender, Chem97)
ChemTabDf <- as.data.frame.table(ChemTab)
env <- environmental
env$ozone <- env$ozone^(1/3)
env$Radiation <- equal.count(env$radiation, 4)

<span class="comment">## Figure 6.6</span>
cloud(ozone ~ wind + temperature | Radiation, env)

<span class="comment">## Figure 6.7</span>
splom(env[1:4])

fm1.env <- lm(ozone ~ radiation * temperature * wind, env)
fm2.env <- 
    loess(ozone ~ wind * temperature * radiation, env,
          span = 0.75, degree = 1)
fm3.env <- 
    loess(ozone ~ wind * temperature * radiation, env,
          parametric = c("radiation", "wind"), 
          span = 0.75, degree = 2)
library("locfit")
fm4.env <- locfit(ozone ~ wind * temperature * radiation, env)
w.mesh <- with(env, do.breaks(range(wind), 50))
t.mesh <- with(env, do.breaks(range(temperature), 50))
r.mesh <- with(env, do.breaks(range(radiation), 3))
grid <- 
    expand.grid(wind = w.mesh, 
                temperature = t.mesh,
                radiation = r.mesh)
grid[["fit.linear"]] <- predict(fm1.env, newdata = grid)
grid[["fit.loess.1"]] <- as.vector(predict(fm2.env, newdata = grid))
grid[["fit.loess.2"]] <- as.vector(predict(fm3.env, newdata = grid))
grid[["fit.locfit"]] <- predict(fm4.env, newdata = grid)

<span class="comment">## Figure 6.8</span>
wireframe(fit.linear + fit.loess.1 + fit.loess.2 + fit.locfit ~ 
                                     wind * temperature | radiation, 
          grid, outer = TRUE, shade = TRUE, zlab = "")

<span class="comment">## Figure 6.9</span>
levelplot(fit.linear + fit.loess.1 + fit.loess.2 + fit.locfit ~ 
                                     wind * temperature | radiation, 
          data = grid)

<span class="comment">## Figure 6.10</span>
levelplot(fit.linear + fit.loess.1 + fit.loess.2 + fit.locfit ~ 
                                     wind * temperature | radiation, 
          data = grid)

<span class="comment">## Figure 6.11</span>
levelplot(volcano)
contourplot(volcano, cuts = 20, label = FALSE)
wireframe(volcano, panel.aspect = 0.7, zoom = 1, lwd = 0.01)

data(Chem97, package = "mlmRev")
Chem97$gcd <-
    with(Chem97, 
         cut(gcsescore,
             breaks = quantile(gcsescore, ppoints(11, a = 1))))
ChemTab <- xtabs(~ score + gcd + gender, Chem97)
ChemTabDf <- as.data.frame.table(ChemTab)
data(Cars93, package = "MASS")
cor.Cars93 <- cor(Cars93[, !sapply(Cars93, is.factor)], use = "pair")

<span class="comment">## Figure 6.12</span>
levelplot(cor.Cars93, 
          scales = list(x = list(rot = 90)))

ord <- order.dendrogram(as.dendrogram(hclust(dist(cor.Cars93))))

<span class="comment">## Figure 6.13</span>
levelplot(cor.Cars93[ord, ord], at = do.breaks(c(-1.01, 1.01), 20),
          scales = list(x = list(rot = 90)))

tick.at <- pretty(range(sqrt(ChemTabDf$Freq)))

<span class="comment">## Figure 6.14</span>
levelplot(sqrt(Freq) ~ score * gcd | gender, ChemTabDf, 
          shrink = c(0.7, 1),
          colorkey = 
          list(labels = list(at = tick.at, labels = tick.at^2)),
          aspect = "iso")

library("latticeExtra")

<span class="comment">## Figure 6.15</span>
cloud(Freq ~ score * gcd | gender, data = ChemTabDf,
      screen = list(z = -40, x = -25), zoom = 1.1,
      col.facet = "grey", xbase = 0.6, ybase = 0.6,
      par.settings = list(box.3d = list(col = "transparent")),
      aspect = c(1.5, 0.75), panel.aspect = 0.75,
      panel.3d.cloud = panel.3dbars)

library("copula")
grid <-
    expand.grid(u = do.breaks(c(0.01, 0.99), 25),
                v = do.breaks(c(0.01, 0.99), 25))
grid$frank  <- with(grid, dcopula(frankCopula(2),    cbind(u, v)))
grid$gumbel <- with(grid, dcopula(gumbelCopula(1.2), cbind(u, v)))
grid$normal <- with(grid, dcopula(normalCopula(.4),  cbind(u, v)))
grid$t      <- with(grid, dcopula(tCopula(0.4),      cbind(u, v)))

<span class="comment">## Figure 6.16</span>
wireframe(frank + gumbel + normal + t ~ u * v, grid, outer = TRUE, 
          zlab = "", screen = list(z = -30, x = -50), lwd = 0.01)

<span class="comment">## Figure 6.17</span>
wireframe(frank + gumbel + normal + t ~ u * v, grid, outer = TRUE, 
          zlab = "", screen = list(z = -30, x = -50), 
          scales = list(z = list(log = TRUE)), lwd = 0.01)

kx <- function(u, v)
    cos(u) * (r + cos(u/2) * sin(t*v) - sin(u/2) * sin(2*t*v))
ky <- function(u, v) 
    sin(u) * (r + cos(u/2) * sin(t*v) - sin(u/2) * sin(2*t*v))
kz <- function(u, v) 
    sin(u/2) * sin(t*v) + cos(u/2) * sin(t*v)
n <- 50
u <- seq(0.3, 1.25, length = n) * 2 * pi
v <- seq(0, 1, length = n) * 2 * pi
um <- matrix(u, length(u), length(u))
vm <- matrix(v, length(v), length(v), byrow = TRUE)
r <- 2
t <- 1

<span class="comment">## Figure 6.18</span>
wireframe(kz(um, vm) ~ kx(um, vm) + ky(um, vm), shade = TRUE,
          screen = list(z = 170, x = -60),
          alpha = 0.75, panel.aspect = 0.6, aspect = c(1, 0.4))

data(USAge.df, package = "latticeExtra")
str(USAge.df)
library("RColorBrewer")
brewer.div <-
    colorRampPalette(brewer.pal(11, "Spectral"),
                     interpolate = "spline")

<span class="comment">## Figure 6.19</span>
levelplot(Population ~ Year * Age | Sex, data = USAge.df,
          cuts = 199, col.regions = brewer.div(200),
          aspect = "iso")

</div>
<div class="codeListingHidden" id="CODE.07"><span class="comment">## Chapter 7</span>

vad.plot <- 
    dotplot(reorder(Var2, Freq) ~ Freq | Var1,
            data = as.data.frame.table(VADeaths), 
            origin = 0, type = c("p", "h"),
            main = "Death Rates in Virginia - 1940", 
            xlab = "Number of deaths per 100")

<span class="comment">## Figure 7.1</span>
vad.plot

dot.line.settings <- trellis.par.get("dot.line")
str(dot.line.settings)
dot.line.settings$col <- "transparent"
trellis.par.set("dot.line", dot.line.settings)
plot.line.settings <- trellis.par.get("plot.line")
str(plot.line.settings)
plot.line.settings$lwd <- 2
trellis.par.set("plot.line", plot.line.settings)

<span class="comment">## Figure 7.2</span>
vad.plot

panel.dotline <- 
    function(x, y, 
             col = dot.symbol$col, pch = dot.symbol$pch,
             cex = dot.symbol$cex, alpha = dot.symbol$alpha,
             col.line = plot.line$col, lty = plot.line$lty,
             lwd = plot.line$lwd, alpha.line = plot.line$alpha,
             ...)
{
    dot.symbol <- trellis.par.get("dot.symbol")
    plot.line <- trellis.par.get("plot.line")
    panel.segments(0, y, x, y, col = col.line, lty = lty, 
                   lwd = lwd, alpha = alpha.line)
    panel.points(x, y, col = col, pch = pch, cex = cex, alpha = alpha)
}
trellis.par.set(dot.line = dot.line.settings,
                plot.line = plot.line.settings)
trellis.par.set(dot.line = list(col = "transparent"),
                plot.line = list(lwd = 2))
trellis.par.set(list(dot.line = list(col = "transparent"),
                     plot.line = list(lwd = 2)))

<span class="comment">## Figure 7.2 (alternative)</span>
update(vad.plot, 
       par.settings = list(dot.line = list(col = "transparent"),
                           plot.line = list(lwd = 2)))

tp <- trellis.par.get()
unusual <- 
    c("grid.pars", "fontsize", "clip", 
      "axis.components", 
      "layout.heights", "layout.widths")
for (u in unusual) tp[[u]] <- NULL
names.tp <- lapply(tp, names)
unames <- sort(unique(unlist(names.tp)))
ans <- matrix(0, nrow = length(names.tp), ncol = length(unames))
rownames(ans) <- names(names.tp)
colnames(ans) <- unames
for (i in seq(along = names.tp))
    ans[i, ] <- as.numeric(unames %in% names.tp[[i]])
ans <- ans[, order(-colSums(ans))]
ans <- ans[order(rowSums(ans)), ]
ans[ans == 0] <- NA

<span class="comment">## Figure 7.3</span>
levelplot(t(ans), colorkey = FALSE, 
          scales = list(x = list(rot = 90)),
          panel = function(x, y, z, ...) {
              panel.abline(v = unique(as.numeric(x)), 
                           h = unique(as.numeric(y)), 
                           col = "darkgrey")
              panel.xyplot(x, y, pch = 16 * z, ...)
          },
          xlab = "Graphical parameters", 
          ylab = "Setting names")

<span class="comment">## Figure 7.4</span>
show.settings()

</div>
<div class="codeListingHidden" id="CODE.08"><span class="comment">## Chapter 8</span>

<span class="comment">## Figure 8.1</span>
stripplot(depth ~ factor(mag), data = quakes, jitter.data = TRUE, 
          scales = list(y = "free", rot = 0),
          prepanel = function(x, y, ...) list(ylim = rev(range(y))),
          xlab = "Magnitude (Richter scale)")

data(biocAccess, package = "latticeExtra")

<span class="comment">## Figure 8.2</span>
xyplot(counts/1000 ~ time | equal.count(as.numeric(time), 
                                        9, overlap = 0.1), 
       biocAccess, type = "l", aspect = "xy", strip = FALSE,
       ylab = "Numer of accesses (thousands)", xlab = "",
       scales = list(x = list(relation = "sliced", axs = "i"), 
                     y = list(alternating = FALSE)))

data(Earthquake, package = "MEMSS")

<span class="comment">## Figure 8.3</span>
xyplot(accel ~ distance, data = Earthquake,
       prepanel = prepanel.loess, aspect = "xy",
       type = c("p", "g", "smooth"),
       scales = list(log = 2),
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)")

yscale.components.log2 <- function(...) {
    ans <- yscale.components.default(...)
    ans$right <- ans$left
    ans$left$labels$labels <- 
        parse(text = ans$left$labels$labels)
    ans$right$labels$labels <- 
        MASS::fractions(2^(ans$right$labels$at))
    ans
}
logTicks <- function (lim, loc = c(1, 5)) {
    ii <- floor(log10(range(lim))) + c(-1, 2)
    main <- 10^(ii[1]:ii[2])
    r <- as.numeric(outer(loc, main, "*"))
    r[lim[1] <= r & r <= lim[2]]
}
xscale.components.log2 <- function(lim, ...) {
    ans <- xscale.components.default(lim = lim, ...)
    tick.at <- logTicks(2^lim, loc = c(1, 3))
    ans$bottom$ticks$at <- log(tick.at, 2)
    ans$bottom$labels$at <- log(tick.at, 2)
    ans$bottom$labels$labels <- as.character(tick.at)
    ans
}

<span class="comment">## Figure 8.4</span>
xyplot(accel ~ distance | cut(Richter, c(4.9, 5.5, 6.5, 7.8)),
       data = Earthquake, type = c("p", "g"),
       scales = list(log = 2, y = list(alternating = 3)),
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)",
       xscale.components = xscale.components.log2,
       yscale.components = yscale.components.log2)

xscale.components.log10 <- function(lim, ...) {
    ans <- xscale.components.default(lim = lim, ...)
    tick.at <- logTicks(10^lim, loc = 1:9)
    tick.at.major <- logTicks(10^lim, loc = 1)
    major <- tick.at %in% tick.at.major
    ans$bottom$ticks$at <- log(tick.at, 10)
    ans$bottom$ticks$tck <- ifelse(major, 1.5, 0.75)
    ans$bottom$labels$at <- log(tick.at, 10)
    ans$bottom$labels$labels <- as.character(tick.at)
    ans$bottom$labels$labels[!major] <- ""
    ans$bottom$labels$check.overlap <- FALSE
    ans
}

<span class="comment">## Figure 8.5</span>
xyplot(accel ~ distance, data = Earthquake, 
       prepanel = prepanel.loess, aspect = "xy", 
       type = c("p", "g"), scales = list(log = 10),
       xlab = "Distance From Epicenter (km)",
       ylab = "Maximum Horizontal Acceleration (g)",
       xscale.components = xscale.components.log10)

axis.CF <- function(side, ...) {
    if (side == "right") {
        F2C <- function(f) 5 * (f - 32) / 9 
        C2F <- function(c) 32 + 9 * c / 5 
        ylim <- current.panel.limits()$ylim
        prettyF <- pretty(ylim)
        prettyC <- pretty(F2C(ylim))
        panel.axis(side = side, outside = TRUE, at = prettyF, 
                   tck = 5, line.col = "grey65", text.col = "grey35")
        panel.axis(side = side, outside = TRUE, at = C2F(prettyC), 
                   labels = as.character(prettyC),
                   tck = 1, line.col = "black", text.col = "black")
    }
    else axis.default(side = side, ...)
}

<span class="comment">## Figure 8.6</span>
xyplot(nhtemp ~ time(nhtemp), aspect = "xy", type = "o",
       scales = list(y = list(alternating = 2, tck = c(1, 5))),
       axis = axis.CF, xlab = "Year", ylab = "Temperature", 
       main = "Yearly temperature in New Haven, CT",
       key = list(text = list(c("(Celcius)", "(Fahrenheit)"), 
                  col = c("black", "grey35")), columns = 2))

</div>
<div class="codeListingHidden" id="CODE.09"><span class="comment">## Chapter 9</span>

data(Cars93, package = "MASS")
table(Cars93$Cylinders)
sup.sym <- Rows(trellis.par.get("superpose.symbol"), 1:5)
str(sup.sym)

<span class="comment">## Figure 9.1</span>
xyplot(Price ~ EngineSize | reorder(AirBags, Price), data = Cars93, 
       groups = Cylinders, subset = Cylinders != "rotary", 
       scales = list(y = list(log = 2, tick.number = 3)), 
       xlab = "Engine Size (litres)", 
       ylab = "Average Price (1000 USD)",
       key = list(text = list(levels(Cars93$Cylinders)[1:5]), 
                  points = sup.sym, space = "right"))

<span class="comment">## Figure 9.1 (alternative, using auto.key)</span>
xyplot(Price ~ EngineSize | reorder(AirBags, Price), data = Cars93, 
       groups = Cylinders, subset = Cylinders != "rotary", 
       scales = list(y = list(log = 2, tick.number = 3)), 
       xlab = "Engine Size (litres)", 
       ylab = "Average Price (1000 USD)",
       auto.key = list(text = levels(Cars93$Cylinders)[1:5], 
                       space = "right", points = TRUE))

<span class="comment">## Figure 9.1 (yet another alternative, using drop=TRUE)</span>
xyplot(Price ~ EngineSize | reorder(AirBags, Price),
       data = subset(Cars93, Cylinders != "rotary"),
       groups = Cylinders[, drop = TRUE],
       scales = list(y = list(log = 2, tick.number = 3)),
       xlab = "Engine Size (litres)",
       ylab = "Average Price (1000 USD)",
       auto.key = list(space = "right"))

my.pch <- c(21:25, 20)
my.fill <- c("transparent", "grey", "black")

<span class="comment">## Figure 9.2</span>
with(Cars93, 
     xyplot(Price ~ EngineSize, 
            scales = list(y = list(log = 2, tick.number = 3)),
            panel = function(x, y, ..., subscripts) {
                pch <- my.pch[Cylinders[subscripts]]
                fill <- my.fill[AirBags[subscripts]]
                panel.xyplot(x, y, pch = pch, 
                             fill = fill, col = "black")
            },
            key = list(space = "right", adj = 1,
                       text = list(levels(Cylinders)), 
                       points = list(pch = my.pch), 
                       text = list(levels(AirBags)), 
                       points = list(pch = 21, fill = my.fill),
                       rep = FALSE)))

hc1 <- hclust(dist(USArrests, method = "canberra"))
hc1 <- as.dendrogram(hc1)
ord.hc1 <- order.dendrogram(hc1)
hc2 <- reorder(hc1, state.region[ord.hc1])
ord.hc2 <- order.dendrogram(hc2)
library(latticeExtra)
region.colors <- trellis.par.get("superpose.polygon")$col

<span class="comment">## Figure 9.3</span>
levelplot(t(scale(USArrests))[, ord.hc2], 
          scales = list(x = list(rot = 90)),
          colorkey = FALSE,
          legend =
          list(right =
               list(fun = dendrogramGrob,
                    args =
                    list(x = hc2, ord = ord.hc2,
                         side = "right", size = 10, size.add = 0.5,
                         add = list(rect =
                           list(col = "transparent",
                              fill = region.colors[state.region])),
                         type = "rectangle"))))



</div>
<div class="codeListingHidden" id="CODE.10"><span class="comment">## Chapter 10</span>

Titanic1 <- as.data.frame(as.table(Titanic[, , "Adult" ,])) 
Titanic1

<span class="comment">## Figure 10.1</span>
barchart(Class ~ Freq | Sex, Titanic1, 
         groups = Survived, stack = TRUE, 
         auto.key = list(title = "Survived", columns = 2))

Titanic2 <- 
    reshape(Titanic1, direction = "wide", v.names = "Freq", 
            idvar = c("Class", "Sex"), timevar = "Survived")
names(Titanic2) <- c("Class", "Sex", "Dead", "Alive")
Titanic2

<span class="comment">## Figure 10.2</span>
barchart(Class ~ Dead + Alive | Sex, 
         Titanic2, 
         stack = TRUE, 
         auto.key = list(columns = 2))

data(Gcsemv, package = "mlmRev")

<span class="comment">## Figure 10.3</span>
xyplot(written ~ course | gender, data = Gcsemv, 
       type = c("g", "p", "smooth"),
       xlab = "Coursework score", ylab = "Written exam score",
       panel = function(x, y, ...) {
           panel.xyplot(x, y, ...)
           panel.rug(x = x[is.na(y)], y = y[is.na(x)])
       })

<span class="comment">## Figure 10.4</span>
qqmath( ~ written + course, Gcsemv, type = c("p", "g"), 
       outer = TRUE, groups = gender, auto.key = list(columns = 2),
       f.value = ppoints(200), ylab = "Score")

set.seed(20051028)
x1 <- rexp(2000)
x1 <- x1[x1 > 1]
x2 <- rexp(1000)
str(make.groups(x1, x2))

<span class="comment">## Figure 10.5</span>
qqmath(~ data, make.groups(x1, x2), groups = which, 
       distribution = qexp, aspect = "iso", type = c('p', 'g'))

str(beaver1)
str(beaver2)
beavers <- make.groups(beaver1, beaver2)
str(beavers)
beavers$hour <- 
    with(beavers, time %/% 100 + 24*(day - 307) + (time %% 100)/60)

<span class="comment">## Figure 10.6</span>
xyplot(temp ~ hour | which, data = beavers, groups = activ, 
       auto.key = list(text = c("inactive", "active"), columns = 2),
       xlab = "Time (hours)", ylab = "Body Temperature (C)", 
       scales = list(x = list(relation = "sliced")))

data(USAge.df, package = "latticeExtra")
head(USAge.df)

<span class="comment">## Figure 10.7</span>
xyplot(Population ~ Age | factor(Year), USAge.df, 
       groups = Sex, type = c("l", "g"),
       auto.key = list(points = FALSE, lines = TRUE, columns = 2),
       aspect = "xy", ylab = "Population (millions)",
       subset = Year %in% seq(1905, 1975, by = 10))

<span class="comment">## Figure 10.8</span>
xyplot(Population ~ Year | factor(Age), USAge.df, 
       groups = Sex, type = "l", strip = FALSE, strip.left = TRUE, 
       layout = c(1, 3), ylab = "Population (millions)", 
       auto.key = list(lines = TRUE, points = FALSE, columns = 2),
       subset = Age %in% c(0, 10, 20))

<span class="comment">## Figure 10.9</span>
xyplot(Population ~ Year | factor(Year - Age), USAge.df, 
       groups = Sex, subset = (Year - Age) %in% 1894:1905,
       type = c("g", "l"), ylab = "Population (millions)", 
       auto.key = list(lines = TRUE, points = FALSE, columns = 2))

<span class="comment">## Figure 10.10</span>
xyplot(stations ~ mag, quakes, jitter.x = TRUE, 
       type = c("p", "smooth"),
       xlab = "Magnitude (Richter)", 
       ylab = "Number of stations reporting") 

quakes$Mag <- equal.count(quakes$mag, number = 10, overlap = 0.2)
summary(quakes$Mag)
as.character(levels(quakes$Mag))
ps.mag <- plot(quakes$Mag, ylab = "Level",
               xlab = "Magnitude (Richter)")
bwp.quakes <- 
    bwplot(stations ~ Mag, quakes, xlab = "Magnitude", 
           ylab = "Number of stations reporting")

<span class="comment">## Figure 10.11</span>
plot(bwp.quakes, position = c(0, 0, 1, 0.65))
plot(ps.mag, position = c(0, 0.65, 1, 1), newpage = FALSE)

<span class="comment">## Figure 10.12</span>
bwplot(sqrt(stations) ~ Mag, quakes, 
       scales = 
       list(x = list(limits = as.character(levels(quakes$Mag)), 
                     rot = 60)),
       xlab = "Magnitude (Richter)",
       ylab = expression(sqrt("Number of stations")))

<span class="comment">## Figure 10.13</span>
qqmath(~ sqrt(stations) | Mag, quakes, 
       type = c("p", "g"), pch = ".", cex = 3, 
       prepanel = prepanel.qqmathline, aspect = "xy",
       strip = strip.custom(strip.levels = TRUE, 
                            strip.names = FALSE),
       xlab = "Standard normal quantiles", 
       ylab = expression(sqrt("Number of stations")))

<span class="comment">## Figure 10.14</span>
xyplot(sqrt(stations) ~ mag, quakes, cex = 0.6,
       panel = panel.bwplot, horizontal = FALSE, box.ratio = 0.05, 
       xlab = "Magnitude (Richter)", 
       ylab = expression(sqrt("Number of stations")))

state.density <-
    data.frame(name = state.name,
               area = state.x77[, "Area"],
               population = state.x77[, "Population"],
               region = state.region)
state.density$density <- with(state.density, population / area)

<span class="comment">## Figure 10.15</span>
dotplot(reorder(name, density) ~ density, state.density,
        xlab = "Population Density (thousands per square mile)")

state.density$Density <-
    shingle(state.density$density,
            intervals = rbind(c(0, 0.2),
                              c(0.2, 1)))

<span class="comment">## Figure 10.16</span>
dotplot(reorder(name, density) ~ density | Density, state.density,
        strip = FALSE, layout = c(2, 1), levels.fos = 1:50,
        scales = list(x = "free"), between = list(x = 0.5),
        xlab = "Population Density (thousands per square mile)", 
        par.settings = list(layout.widths = list(panel = c(2, 1))))

cutAndStack <- 
    function(x, number = 6, overlap = 0.1, type = 'l',
             xlab = "Time", ylab = deparse(substitute(x)), ...) {
    time <- if (is.ts(x)) time(x) else seq_along(x)
    Time <- equal.count(as.numeric(time), 
                        number = number, overlap = overlap)
    xyplot(as.numeric(x) ~ time | Time,
           type = type, xlab = xlab, ylab = ylab,
           default.scales = list(x = list(relation = "free"),
                                 y = list(relation = "free")),
           ...)
}

<span class="comment">## Figure 10.17</span>
cutAndStack(EuStockMarkets[, "DAX"], aspect = "xy",
            scales = list(x = list(draw = FALSE), 
                          y = list(rot = 0)))

bdp1 <- 
dotplot(as.character(variety) ~ yield | as.character(site), barley,
        groups = year, layout = c(1, 6),
        auto.key = list(space = "top", columns = 2),
        ## strip = FALSE, strip.left = TRUE,
        aspect = "fill")
bdp2 <- 
dotplot(variety ~ yield | site, barley,
        groups = year, layout = c(1, 6),
        auto.key = list(space = "top", columns = 2),
        ## strip = FALSE, strip.left = TRUE)
        aspect = "fill")

<span class="comment">## Figure 10.18</span>
plot(bdp1, split = c(1, 1, 2, 1))
plot(bdp2, split = c(2, 1, 2, 1), newpage = FALSE)

state.density <-
    data.frame(name = state.name,
               area = state.x77[, "Area"],
               population = state.x77[, "Population"],
               region = state.region)
state.density$density <- with(state.density, population / area)

<span class="comment">## Figure 10.19</span>
dotplot(reorder(name, density) ~ 1000 * density, state.density, 
        scales = list(x = list(log = 10)), 
        xlab = "Density (per square mile)")

state.density$region <- 
    with(state.density, reorder(region, density, median))
state.density$name <- 
    with(state.density, 
         reorder(reorder(name, density), as.numeric(region)))

<span class="comment">## Figure 10.20</span>
dotplot(name ~ 1000 * density | region, state.density, 
        strip = FALSE, strip.left = TRUE, layout = c(1, 4),
        scales = list(x = list(log = 10),
                      y = list(relation = "free")),
        xlab = "Density (per square mile)")

library("latticeExtra")

<span class="comment">## Figure 10.21</span>
resizePanels()

data(USCancerRates, package = "latticeExtra")

<span class="comment">## Figure 10.22</span>
xyplot(rate.male ~ rate.female | state, USCancerRates,
       aspect = "iso", pch = ".", cex = 2,
       index.cond = function(x, y) { median(y - x, na.rm = TRUE) },
       scales = list(log = 2, at = c(75, 150, 300, 600)), 
       panel = function(...) {
           panel.grid(h = -1, v = -1)
           panel.abline(0, 1)
           panel.xyplot(...)
       })

strip.style4 <- function(..., style) {
    strip.default(..., style = 4)
}
data(Chem97, package = "mlmRev")

<span class="comment">## Figure 10.23</span>
qqmath(~gcsescore | factor(score), Chem97, groups = gender, 
       type = c("l", "g"),  aspect = "xy", 
       auto.key = list(points = FALSE, lines = TRUE, columns = 2),
       f.value = ppoints(100), strip = strip.style4,
       xlab = "Standard normal quantiles", 
       ylab = "Average GCSE score")

<span class="comment">## Figure 10.24</span>
qqmath(~gcsescore | factor(score), Chem97, groups = gender, 
       type = c("l", "g"),  aspect = "xy", 
       auto.key = list(points = FALSE, lines = TRUE, columns = 2),
       f.value = ppoints(100), strip = strip.custom(style = 4),
       xlab = "Standard normal quantiles", 
       ylab = "Average GCSE score")

strip.combined <- 
    function(which.given, which.panel, factor.levels, ...) {
    if (which.given == 1) {
        panel.rect(0, 0, 1, 1, col = "grey90", border = 1)
        panel.text(x = 0, y = 0.5, pos = 4, 
                   lab = factor.levels[which.panel[which.given]])
    }
    if (which.given == 2) {
        panel.text(x = 1, y = 0.5, pos = 2,
                   lab = factor.levels[which.panel[which.given]])
    }
}

<span class="comment">## Figure 10.25</span>
qqmath(~ gcsescore | factor(score) + gender, Chem97, 
       f.value = ppoints(100), type = c("l", "g"), aspect = "xy",
       strip = strip.combined,
       par.strip.text = list(lines = 0.5),
       xlab = "Standard normal quantiles", 
       ylab = "Average GCSE score")

</div>
<div class="codeListingHidden" id="CODE.11"><span class="comment">## Chapter 11</span>

methods(class = "trellis")
methods(class = "shingle")
methods(generic.function = "barchart")

dp.uspe <- 
    dotplot(t(USPersonalExpenditure), 
            groups = FALSE, 
            index.cond = function(x, y) median(x),
            layout = c(1, 5), 
            type = c("p", "h"),
            xlab = "Expenditure (billion dollars)")
dp.uspe.log <- 
    dotplot(t(USPersonalExpenditure), 
            groups = FALSE, 
            index.cond = function(x, y) median(x),
            layout = c(1, 5), 
            scales = list(x = list(log = 2)),
            xlab = "Expenditure (billion dollars)")
  
<span class="comment">## Figure 11.1</span>
plot(dp.uspe,     split = c(1, 1, 2, 1), more = TRUE)
plot(dp.uspe.log, split = c(2, 1, 2, 1), more = FALSE)

state <- data.frame(state.x77, state.region, state.name)
state$state.name <- 
    with(state, reorder(reorder(state.name, Frost), 
                        as.numeric(state.region)))
dpfrost <- 
    dotplot(state.name ~ Frost | reorder(state.region, Frost),
            data = state, layout = c(1, 4),
            scales = list(y = list(relation = "free")))
summary(dpfrost)
  
<span class="comment">## Figure 11.2</span>
plot(dpfrost, 
     panel.height = list(x = c(16, 13, 9, 12), unit = "null"))
  
<span class="comment">## Figure 11.3</span>
update(trellis.last.object(), layout = c(1, 1))[2]

npanel <- 12
rot <- list(z = seq(0, 30, length = npanel), 
            x = seq(0, -80, length = npanel))
quakeLocs <-
    cloud(depth ~ long + lat, quakes, pch = ".", cex = 1.5,
          panel = function(..., screen) {
              pn <- panel.number()
              panel.cloud(..., screen = list(z = rot$z[pn], 
                                             x = rot$x[pn]))
          },
          xlab = NULL, ylab = NULL, zlab = NULL, 
          scales = list(draw = FALSE), zlim = c(690, 30), 
          par.settings = list(axis.line = list(col="transparent")))
  
<span class="comment">## Figure 11.4</span>
quakeLocs[rep(1, npanel)]

data(Chem97, package="mlmRev")
ChemQQ <- 
    qq(gender ~ gcsescore | factor(score), Chem97, 
       f.value = ppoints(100), strip = strip.custom(style = 5))
  
<span class="comment">## Figure 11.5</span>
tmd(ChemQQ)

library("latticeExtra")
data(biocAccess)
baxy <- xyplot(log10(counts) ~ hour | month + weekday, biocAccess,
               type = c("p", "a"), as.table = TRUE,
               pch = ".", cex = 2, col.line = "black")
dimnames(baxy)$month
dimnames(baxy)$month <- month.name[1:5]
dimnames(baxy)
  
<span class="comment">## Figure 11.6</span>
useOuterStrips(baxy)

</div>
<div class="codeListingHidden" id="CODE.12"><span class="comment">## Chapter 12</span>

state <- data.frame(state.x77, state.region)
trellis.vpname("xlab", prefix = "plot1")
trellis.vpname("strip", column = 2, row = 2, prefix = "plot2")

data(Chem97, package = "mlmRev")
  
<span class="comment">## Figure 12.1</span>
qqmath(~ gcsescore | factor(score), Chem97, groups = gender,
       f.value = function(n) ppoints(100),
       aspect = "xy", 
       page = function(n) {
           cat("Click on plot to place legend", fill = TRUE)
           ll <- grid.locator(unit = "npc")
           if (!is.null(ll))
               draw.key(simpleKey(levels(factor(Chem97$gender))),
                        vp = viewport(x = ll$x, y = ll$y),
                        draw = TRUE)
       })

state <- data.frame(state.x77, state.region)
  
<span class="comment">## Figure 12.2</span>
xyplot(Murder ~ Life.Exp | state.region, data = state, 
       layout = c(2, 2), type = c("p", "g"), subscripts = TRUE)
while (!is.null(fp <- trellis.focus())) {
    if (fp$col > 0 & fp$row > 0)
        panel.identify(labels = rownames(state))
}

<span class="comment">## Figure 12.3</span>
qqmath(~ (1000 * Population / Area), state, 
       ylab = "Population Density (per square mile)",
       xlab = "Standard Normal Quantiles",
       scales = list(y = list(log = TRUE, at = 10^(0:3))))
trellis.focus()
do.call(panel.qqmathline, trellis.panelArgs())
panel.identify.qqmath(labels = row.names(state))
trellis.unfocus()


env <- environmental
env$ozone <- env$ozone^(1/3)
  
<span class="comment">## Figure 12.4</span>
splom(env, pscales = 0, col = "grey")
trellis.focus("panel", 1, 1, highlight = FALSE)
panel.link.splom(pch = 16, col = "black")
trellis.unfocus()


state$name <- with(state, 
                   reorder(reorder(factor(rownames(state)), Frost), 
                           as.numeric(state.region)))
  
<span class="comment">## Figure 12.5</span>
dotplot(name ~ Frost | reorder(state.region, Frost), data = state, 
        layout = c(1, 4), scales = list(y = list(relation="free")))
trellis.currentLayout()
heights <- 
    sapply(seq_len(nrow(trellis.currentLayout())),
           function(i) {
               trellis.focus("panel", column = 1, row = i, 
                             highlight = FALSE)
               h <- diff(current.panel.limits()$ylim)
               trellis.unfocus()
               h
           })
heights
  
<span class="comment">## Figure 12.6</span>
update(trellis.last.object(), 
       par.settings = list(layout.heights = list(panel = heights)))



</div>
<div class="codeListingHidden" id="CODE.13"><span class="comment">## Chapter 13</span>

panel.hypotrochoid <- function(r, d, cycles = 10, density = 30)
{
    if (missing(r)) r <- runif(1, 0.25, 0.75)
    if (missing(d)) d <- runif(1, 0.25 * r, r)
    t <- 2 * pi * seq(0, cycles, by = 1/density)
    x <- (1 - r) * cos(t) + d * cos((1 - r) * t / r)
    y <- (1 - r) * sin(t) - d * sin((1 - r) * t / r)
    panel.lines(x, y)
}
panel.hypocycloid <- function(x, y, cycles = x, density = 30) {
    panel.hypotrochoid(r = x / y, d = x / y, 
                       cycles = cycles, density = density)
}
prepanel.hypocycloid <- function(x, y) {
    list(xlim = c(-1, 1), ylim = c(-1, 1))
}
grid <- data.frame(p = 11:30, q = 10)
grid$k <- with(grid, factor(p / q))

<span class="comment">## Figure 13.1</span>
xyplot(p ~ q | k, grid, aspect = 1, scales = list(draw = FALSE),
       prepanel = prepanel.hypocycloid, panel = panel.hypocycloid)

p <- xyplot(c(-1, 1) ~ c(-1, 1), aspect = 1, cycles = 15,
            scales = list(draw = FALSE), xlab = "", ylab = "",
            panel = panel.hypotrochoid)
set.seed(20070706)

<span class="comment">## Figure 13.2</span>
p[rep(1, 42)]

library("logspline")
prepanel.ls <- function(x, n = 50, ...) {
    fit <- logspline(x)
    xx <- do.breaks(range(x), n)
    yy <- dlogspline(xx, fit)
    list(ylim = c(0, max(yy)))
}
panel.ls <- function(x, n = 50, ...) {
    fit <- logspline(x)
    xx <- do.breaks(range(x), n)
    yy <- dlogspline(xx, fit)
    panel.lines(xx, yy, ...)
}
faithful$Eruptions <- equal.count(faithful$eruptions, 4)

<span class="comment">## Figure 13.3</span>
densityplot(~ waiting | Eruptions, data = faithful, 
            prepanel = prepanel.ls, panel = panel.ls)

panel.bwtufte <- function(x, y, coef = 1.5, ...) {
    x <- as.numeric(x); y <- as.numeric(y)
    ux <- sort(unique(x))
    blist <- tapply(y, factor(x, levels = ux), boxplot.stats, 
                    coef = coef, do.out = FALSE)
    blist.stats <- t(sapply(blist, "[[", "stats"))
    blist.out <- lapply(blist, "[[", "out")
    panel.points(y = blist.stats[, 3], x = ux, pch = 16, ...)
    panel.segments(x0 = rep(ux, 2),
                   y0 = c(blist.stats[, 1], blist.stats[, 5]),
                   x1 = rep(ux, 2),
                   y1 = c(blist.stats[, 2], blist.stats[, 4]),
                   ...)
}
data(Chem97, package = "mlmRev")

<span class="comment">## Figure 13.4</span>
bwplot(gcsescore^2.34 ~ gender | factor(score), Chem97, 
       panel = panel.bwtufte, layout = c(6, 1),
       ylab = "Transformed GCSE score")

data(Cars93, package = "MASS")
cor.Cars93 <- 
    cor(Cars93[, !sapply(Cars93, is.factor)], use = "pair")
ord <- order.dendrogram(as.dendrogram(hclust(dist(cor.Cars93))))
panel.corrgram <- 
    function(x, y, z, subscripts, at, 
             level = 0.9, label = FALSE, ...) 
{
    require("ellipse", quietly = TRUE)
    x <- as.numeric(x)[subscripts]
    y <- as.numeric(y)[subscripts]
    z <- as.numeric(z)[subscripts]
    zcol <- level.colors(z, at = at, ...)
    for (i in seq(along = z)) {
        ell <- ellipse(z[i], level = level, npoints = 50,
                       scale = c(.2, .2), centre = c(x[i], y[i]))
        panel.polygon(ell, col = zcol[i], border = zcol[i], ...)
    }
    if (label) 
        panel.text(x = x, y = y, lab = 100 * round(z, 2), cex = 0.8,
                   col = ifelse(z < 0, "white", "black"))
}    

<span class="comment">## Figure 13.5</span>
levelplot(cor.Cars93[ord, ord], at = do.breaks(c(-1.01, 1.01), 20), 
          xlab = NULL, ylab = NULL, colorkey = list(space = "top"),
          scales = list(x = list(rot = 90)),
          panel = panel.corrgram, label = TRUE)

panel.corrgram.2 <- 
    function(x, y, z, subscripts, at = pretty(z), scale = 0.8, ...) 
{
    require("grid", quietly = TRUE)
    x <- as.numeric(x)[subscripts]
    y <- as.numeric(y)[subscripts]
    z <- as.numeric(z)[subscripts]
    zcol <- level.colors(z, at = at, ...)
    for (i in seq(along = z))
    {
        lims <- range(0, z[i])
        tval <- 2 * base::pi * 
            seq(from = lims[1], to = lims[2], by = 0.01)
        grid.polygon(x = x[i] + .5 * scale * c(0, sin(tval)),
                     y = y[i] + .5 * scale * c(0, cos(tval)),
                     default.units = "native", 
                     gp = gpar(fill = zcol[i]))
        grid.circle(x = x[i], y = y[i], r = .5 * scale, 
                    default.units = "native")
    }
}

<span class="comment">## Figure 13.6</span>
levelplot(cor.Cars93[ord, ord], xlab = NULL, ylab = NULL,
          at = do.breaks(c(-1.01, 1.01), 101),
          panel = panel.corrgram.2, 
          scales = list(x = list(rot = 90)),
          colorkey = list(space = "top"),
          col.regions = colorRampPalette(c("red", "white", "blue")))

panel.3d.contour <- 
    function(x, y, z, rot.mat, distance, 
             nlevels = 20, zlim.scaled, ...)
{
    add.line <- trellis.par.get("add.line")
    panel.3dwire(x, y, z, rot.mat, distance, 
                 zlim.scaled = zlim.scaled, ...)
    clines <- 
        contourLines(x, y, matrix(z, nrow = length(x), byrow = TRUE),
                     nlevels = nlevels)
    for (ll in clines) {
        m <- ltransform3dto3d(rbind(ll$x, ll$y, zlim.scaled[2]), 
                              rot.mat, distance)
        panel.lines(m[1,], m[2,], col = add.line$col,
                    lty = add.line$lty, lwd = add.line$lwd)
    }
}

<span class="comment">## Figure 13.7</span>
wireframe(volcano, zlim = c(90, 250), nlevels = 10, 
          aspect = c(61/87, .3), panel.aspect = 0.6,
          panel.3d.wireframe = "panel.3d.contour", shade = TRUE,
          screen = list(z = 20, x = -60))

library("maps")
county.map <- map("county", plot = FALSE, fill = TRUE)
str(county.map)
data(ancestry, package = "latticeExtra")
ancestry <- subset(ancestry, !duplicated(county))
rownames(ancestry) <- ancestry$county
freq <- table(ancestry$top)
keep <- names(freq)[freq > 10]
ancestry$mode <-
    with(ancestry,
         factor(ifelse(top %in% keep, top, "Other")))
modal.ancestry <- ancestry[county.map$names, "mode"]
library("RColorBrewer")
colors <- brewer.pal(n = nlevels(ancestry$mode), name = "Pastel1")

<span class="comment">## Figure 13.8</span>
xyplot(y ~ x, county.map, aspect = "iso", 
       scales = list(draw = FALSE), xlab = "", ylab = "",
       par.settings = list(axis.line = list(col = "transparent")),
       col = colors[modal.ancestry], border = NA, 
       panel = panel.polygon,
       key =
       list(text = list(levels(modal.ancestry), adj = 1),
            rectangles = list(col = colors),
            x = 1, y = 0, corner = c(1, 0)))

rad <- function(x) { pi * x / 180 }
county.map$xx <- with(county.map, cos(rad(x)) * cos(rad(y)))
county.map$yy <- with(county.map, sin(rad(x)) * cos(rad(y)))
county.map$zz <- with(county.map, sin(rad(y)))
panel.3dpoly <- function (x, y, z, rot.mat = diag(4), distance, ...) 
{
    m <- ltransform3dto3d(rbind(x, y, z), rot.mat, distance)
    panel.polygon(x = m[1, ], y = m[2, ], ...)
}
aspect <-
    with(county.map,
         c(diff(range(yy, na.rm = TRUE)), 
           diff(range(zz, na.rm = TRUE))) /
         diff(range(xx, na.rm = TRUE)))

<span class="comment">## Figure 13.9</span>
cloud(zz ~ xx * yy, county.map, par.box = list(col = "grey"),
      aspect = aspect, panel.aspect = 0.6, lwd = 0.01,
      panel.3d.cloud = panel.3dpoly, col = colors[modal.ancestry],
      screen = list(z = 10, x = -30),
      key = list(text = list(levels(modal.ancestry), adj = 1),
                 rectangles = list(col = colors), 
                 space = "top", columns = 4),
      scales = list(draw = FALSE), zoom = 1.1, 
      xlab = "", ylab = "", zlab = "")

library("latticeExtra")
library("mapproj")
data(USCancerRates)
rng <- with(USCancerRates, 
            range(rate.male, rate.female, finite = TRUE))
nbreaks <- 50
breaks <- exp(do.breaks(log(rng), nbreaks))

<span class="comment">## Figure 13.10</span>
mapplot(rownames(USCancerRates) ~ rate.male + rate.female,
        data = USCancerRates, breaks = breaks,
        map = map("county", plot = FALSE, fill = TRUE, 
                  projection = "tetra"),
        scales = list(draw = FALSE), xlab = "", 
        main = "Average yearly deaths due to cancer per 100000")

</div>
<div class="codeListingHidden" id="CODE.14"><span class="comment">## Chapter 14</span>

library("latticeExtra")
  
<span class="comment">## Figure 14.1</span>
xyplot(sunspot.year, aspect = "xy", 
       strip = FALSE, strip.left = TRUE,
       cut = list(number = 4, overlap = 0.05))

data(biocAccess, package = "latticeExtra")
ssd <- stl(ts(biocAccess$counts[1:(24 * 30 * 2)], frequency = 24), 
           "periodic")
  
<span class="comment">## Figure 14.2</span>
xyplot(ssd, xlab = "Time (Days)")

library("flowViz")
data(GvHD, package = "flowCore")
  
<span class="comment">## Figure 14.3</span>
densityplot(Visit ~ `FSC-H` | Patient, data = GvHD)

library("hexbin")
data(NHANES)
  
<span class="comment">## Figure 14.4</span>
hexbinplot(Hemoglobin ~ TIBC | Sex, data = NHANES, aspect = 0.8)

panel.piechart <-
    function(x, y, labels = as.character(y),
             edges = 200, radius = 0.8, clockwise = FALSE,
             init.angle = if(clockwise) 90 else 0,
             density = NULL, angle = 45, 
             col = superpose.polygon$col,
             border = superpose.polygon$border,
             lty = superpose.polygon$lty, ...)
{
    stopifnot(require("gridBase"))
    superpose.polygon <- trellis.par.get("superpose.polygon")
    opar <- par(no.readonly = TRUE)
    on.exit(par(opar))
    if (panel.number() > 1) par(new = TRUE)
    par(fig = gridFIG(), omi = c(0, 0, 0, 0), mai = c(0, 0, 0, 0))
    pie(as.numeric(x), labels = labels, edges = edges, radius = radius,
        clockwise = clockwise, init.angle = init.angle, angle = angle,
        density = density, col = col, border  = border, lty = lty)
}
piechart <- function(x, data = NULL, panel = "panel.piechart", ...)
{
    ocall <- sys.call(sys.parent())
    ocall[[1]] <- quote(piechart)
    ccall <- match.call()
    ccall$data <- data
    ccall$panel <- panel
    ccall$default.scales <- list(draw = FALSE)
    ccall[[1]] <- quote(lattice::barchart)
    ans <- eval.parent(ccall)
    ans$call <- ocall
    ans
}
  
<span class="comment">## Figure 14.5</span>
par(new = TRUE)
piechart(VADeaths, groups = FALSE, xlab = "")


</div>


</div>



<div class="footer">
  <address>deepayan.sarkar@r-project.org</address>
  <!-- hhmts start -->Last modified: Tue Oct 28 01:29:08 PDT 2008 <!-- hhmts end -->
</div>


  
</body> </html>
